#!/bin/sh

PHOC_INI="/usr/share/phrog/phoc.ini"

help()
{
  cat <<EOF
phrog - Session start script for Phrog

This is usually invoked by a display manager but you can
also run it from a tty.

Usage: phrog
EOF
  exit 0
}


version()
{
   /usr/libexec/phrog --version
   exit 0
}

case "$1" in
  -h|-\?|--help)
    help
    ;;
  --version)
    version
    ;;
esac

if [ -f /etc/phrog/phoc.ini ]; then
  PHOC_INI=/etc/phrog/phoc.ini
fi

OSK=$(sed -ne 's/^Exec=\(.*\)/\1/p' /usr/share/applications/sm.puri.OSK0.desktop)
[ -n "${OSK}" ] || OSK=squeekboard

# Run phrog through a login shell so it picks
# variables from /etc/profile.d (XDG_*)
[ -n "$WLR_BACKENDS" ] || WLR_BACKENDS=drm,libinput
export WLR_BACKENDS
exec /usr/bin/phoc -S -C "${PHOC_INI}" -E "bash -lc '/usr/libexec/phrog & $OSK'"
